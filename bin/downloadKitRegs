#!/usr/bin/perl

use strict;
use warnings;

my $kitRegFile = "kit-regs.xml";
my $xml = "kit-regs.xml.$$";
`curl 'http://info.xsede.org/web-apps/xml/reg-cat-v1/name/KitRegistration' 2>/dev/null > $xml`;
open( READ, "<$xml" );
open( WRITE, ">$kitRegFile" );
my ($resource, $kit);
while( <READ> ) {
  my $line = $_;
  ($resource) = /<ResourceID>([^<]+)<\/ResourceID>/ if /ResourceID/;
  ($kit) =  /KitID="([^"]+)"/ if /<Kit KitID/;
  $line =~ s/SLURM/slurm/g;
  print WRITE $line;
}
close READ;
close WRITE;
unlink $xml;
