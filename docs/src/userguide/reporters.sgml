<section id="userguide-reporters">
<title>Reporters and Repositories</title>

<para>
Inca reporters are executable programs and scripts, generally small, that test
and report the health and characteristics of a system.  The figure below 
illustrates a typical Inca installation where reporters are retrieved from a repository and sent to Reporter 
Managers on Grid resources by the Agent.  The Reporter Managers then execute the reporters based on series configuration from the 
Agent and send the XML reports to the Depot for storage.
  <graphic fileref="figures/arch-reporters.jpg" align="center"></graphic>
</para>

<section id="reporter-cmdline">
<title>Executing Reporters</title>
<para>
Because they are executables, Inca reporters are independent of the rest of the Inca system.
Reporters can be executed manually from a command line or automatically as part of an Inca installation.  
Incorporating your own reporters into a running Inca installation requires only writing the reporters (<xref linkend="reporter-writing">), 
including them in a repository (<xref linkend="reporter-repositories">), 
and configuring the repository's series using incat (<xref linkend="userguide-incat">).  Most developers will execute reporters from the 
command line before adding them to their Inca installation.   After installing Inca, you can try executing some of the reporters that come
with the distribution from the command line:
<screen>
% cd $INCA_DIST/Inca-Reporter-*/bin
% setenv PERL5LIB ../lib
% ./cluster.compiler.gcc.version 
</screen>
You should now see XML output like that in <xref linkend="reporter-output">.</para>

<para>
All Inca reporters must support the command line arguments listed in the table
below.  In addition, a reporter may support additional command line arguments
specific to that reporter's task.
</para>
<table><title>Reporter Command Line Arguments</title>
<tgroup cols="4">
<thead>
  <row>
    <entry><para>Argument</para></entry>
    <entry><para>Valid Values</para></entry>
    <entry><para>Default Value</para></entry>
    <entry><para>Description</para></entry>
  </row>
</thead>
<tbody>
  <row>
    <entry><para>-help</para></entry>
	    <entry><para>yes|no</para></entry>
	    <entry><para>no</para></entry>
    <entry><para>
    Do not run the reporter; instead, print information on running it.  If
    the value of the verbose argument is 0, this information will be readable
    text; otherwise, it will be reporter XML.
    </para></entry>
  </row><row>
    <entry><para>-log</para></entry>
    <entry><para>0-5|debug|error|info|system|warn</para></entry>
    <entry><para>0</para></entry>
    <entry><para>
    Include reporter log messages in the reporter output.  The named argument
    values indicate specific types of log messages that should be included.  0
    indicates no log messages should be included; the other numeric values
    indicate error, warn, system, info, and debug messages, cumulatively.  For
    example, --log=2 indicates both error and warn messages should be included,
    while --log=4 includes error, warn, system, and info messages.
    </para></entry>
  </row><row>
    <entry><para>-verbose</para></entry>
    <entry><para>0-2</para></entry>
    <entry><para>1</para></entry>
    <entry><para>
    Determine what the reporter prints.  A verbose level of 0 indicates that
    the reporter prints only 'completed' or 'failed', depending on the outcome
    of its testing.  Verbose level 1 produces XML that reports the testing
    result, and verbose level 2 adds additional tags to this XML to give
    instructions on running the reporter.
    </para></entry>
  </row><row>
    <entry><para>-version</para></entry>
    <entry><para>yes|no</para></entry>
    <entry><para>no</para></entry>
    <entry><para>
    Do not run the reporter; instead, print its version number.
    </para></entry>
  </row>
</tbody>
</tgroup>
</table>
<para>Executing a reporter using different arguments:
<screen>
% ./cluster.compiler.gcc.version -log=3 
% ./cluster.compiler.gcc.version -help=yes -verbose=0
% ./cluster.compiler.gcc.version -version=yes
</screen>
</para>
</section>

<section id="reporter-writing">
<title>Writing Reporters</title>
<para>
Reporters can be written in any language as long as 
they output XML according to the schema described in <xref linkend="reporter-schema">.  
New reporter developers may choose to write reporters in Perl since 
the Inca distribution includes sample Perl reporters and API modules (<xref linkend="reporter-api">) 
for printing XML according to our schema.
</para>
<para>
NOTE: Because some databases won't allow queries greater than 4kB, the XML portion of the report for logging/debugging and the error message must each be smaller than 4kB in size.  The body XML can be 12kB in size because it is queried in three parts.  If the report XML is greater than its limit, the depot truncates the oversized section from the beginning until it is the right size.  
</para>
<section id="reporter-schema">
<title>Reporter XML Schema</title>
<para>
In order to promote interoperability between reporters, we define a
specification for how reporter output should be formatted.  Given the
wide acceptance and availability of tools for XML, the specification
requires that reporter output should be formatted using XML.  Furthermore, we
specify a basic schema that the XML should follow so
that we can handle the output in a general manner.   The goal of this schema
is to be flexible enough to express a wide variety of data.
</para>
<para>
Our approach is to require a number of XML fields which provide metadata about
the output and define one of the fields, body, to be abstract.  The body
field is a placeholder for the formatted output and can be replaced by any XML
 substitution group thereby allowing this schema to accommodate a large variety of output.  In
other words, the basic schema is like an abstract class and the substitution
groups provide for subclassing.  
</para>
<para>The reporter schema is visualized in <xref linkend="reporter-schema-fig">.
<figure id="reporter-schema-fig">
  <title>Inca Reporter Schema</title>
  <graphic fileref="figures/reporter-schema.jpg" align="center">
  </graphic>
</figure>
</para>
</section>

<section id="reporter-output">
<title>Reporter XML Output</title>
<para>
Here is the output from the successful run of a typical Inca reporter.  The
content and meaning of the XML tags is described below.
</para>
<figure id="sample-report">
  <title>Example of Reporter Output</title>
<screen>
&lt;?xml version='1.0'?&gt;
&lt;inca:report xmlns:inca='http://inca.sdsc.edu/dataModel/report_2.1'&gt;
  &lt;gmt&gt;2006-11-17T17:35:40Z&lt;/gmt&gt;
  &lt;hostname&gt;jhayes-Computer.local&lt;/hostname&gt;
  &lt;name&gt;cluster.compiler.gcc.version&lt;/name&gt;
  &lt;version&gt;2&lt;/version&gt;
  &lt;workingDir&gt;/Users/jhayes/Inca/subversion/inca/trunk/devel/reporters/bin&lt;/workingDir&gt;
  &lt;reporterPath&gt;cluster.compiler.gcc.version&lt;/reporterPath&gt;
  &lt;args&gt;
    &lt;arg&gt;
      &lt;name&gt;help&lt;/name&gt;
      &lt;value&gt;no&lt;/value&gt;
    &lt;/arg&gt;
    &lt;arg&gt;
      &lt;name&gt;log&lt;/name&gt;
      &lt;value&gt;0&lt;/value&gt;
    &lt;/arg&gt;
    &lt;arg&gt;
      &lt;name&gt;verbose&lt;/name&gt;
      &lt;value&gt;1&lt;/value&gt;
    &lt;/arg&gt;
    &lt;arg&gt;
      &lt;name&gt;version&lt;/name&gt;
      &lt;value&gt;no&lt;/value&gt;
    &lt;/arg&gt;
  &lt;/args&gt;
  &lt;body&gt;
    &lt;package&gt;
      &lt;ID&gt;gcc&lt;/ID&gt;
      &lt;version&gt;3.3&lt;/version&gt;
    &lt;/package&gt;
  &lt;/body&gt;
  &lt;exitStatus&gt;
    &lt;completed&gt;true&lt;/completed&gt;
  &lt;/exitStatus&gt;
&lt;/inca:report&gt;
</screen>
</figure>
<para>
As shown in <xref linkend="sample-report">, reporter output begins with an XML preamble and is surrounded by &lt;report&gt; tags.
A prefix with a tag name that references
http://inca.sdsc.edu/dataModel/report_2.1, which is the namespace that defines
the report schema, can also be used.
</para><para>
The following tags are defined within a &lt;report&gt;:
</para>

<variablelist>
  <varlistentry><term><filename>gmt</filename></term>
  <listitem><para>
  the time the reporter ran (ISO 8601 format)
  </para> </listitem>
  </varlistentry>

  <varlistentry><term><filename>hostname</filename></term>
  <listitem><para>
  host where reporter ran
  </para> </listitem>
  </varlistentry>

  <varlistentry><term><filename>name</filename></term>  
  <listitem><para>
  reporter name
  </para> </listitem>
  </varlistentry>

  <varlistentry><term><filename>version</filename></term>  
  <listitem><para>
  reporter version number
  </para> </listitem>
  </varlistentry>

  <varlistentry><term><filename>workingDir</filename></term>  
  <listitem><para>
  directory where reporter execution begins
  </para> </listitem>
  </varlistentry>

  <varlistentry><term><filename>reporterPath</filename></term>  
  <listitem><para>
  local path to reporter file
  </para> </listitem>
  </varlistentry>

  <varlistentry><term><filename>args</filename></term>
  <listitem><para>
	args must contain an arg name/value entry for every argument the reporter supports, 
	including those for which the reporter supplies a default value (help, log, verbose, version)
  </para> </listitem>
  </varlistentry>

  <varlistentry><term><filename>log</filename></term>
  <listitem><para>
    OPTIONAL TAG (not shown in <xref linkend="sample-report"> report). Log entries produced by the reporter.  This tag contains one or more
&lt;debug&gt;, &lt;error&gt;, &lt;info&gt;, &lt;system&gt;, and/or &lt;warn&gt;
tags, each of which gives the text of the message and the time it was produced.
Here is a typical example of a log section:
<screen>
  &lt;log&gt;
    &lt;system&gt;
      &lt;gmt&gt;2006-11-17T18:28:10Z&lt;/gmt&gt;
      &lt;message&gt;grid-proxy-info 2&amp;gt;&amp;amp;1&lt;/message&gt;
    &lt;/system&gt;
    &lt;debug&gt;
      &lt;gmt&gt;2006-11-17T18:28:10Z&lt;/gmt&gt;
      &lt;message&gt;Checking for grid proxy: Result of command "grid-proxy-info":
         sh: line 1: grid-proxy-info: command not found
      &lt;/message&gt;
    &lt;/debug&gt;
    &lt;error&gt;
      &lt;gmt&gt;2006-11-17T18:28:10Z&lt;/gmt&gt;
      &lt;message&gt;ERROR: Valid proxy needed for file transfer.&lt;/message&gt;
    &lt;/error&gt;
  &lt;/log&gt;
</screen>
  </para> </listitem>
  </varlistentry>
  
  <varlistentry><term><filename>body</filename></term>
  <listitem><para>
    The body tag contains the results of the reporter testing.  The only
requirement for the contents of this tag is that they must be well-formed
XML--tags balanced and no extraneous &lt;, &gt;, and &amp; characters.  <xref linkend="sample-report">
shows the conventional body for version reporters.
  </para> </listitem>
  </varlistentry>

  <varlistentry><term><filename>exitStatus</filename></term>
  <listitem><para>
Includes the boolean &lt;completed&gt; tag, indicating whether or not the reporter
successfully completed its testing, and the optional &lt;errorMessage&gt; tag,
which contains a string indicating why the reporter failed to complete.
  </para> </listitem>
  </varlistentry>
  
  <varlistentry><term><filename>help</filename></term>
  <listitem><para>
    OPTIONAL TAG (not shown in <xref linkend="sample-report"> report).  The help tag describes the reporter and how to run it.  Contents include
the reporter name, version, description, and url, detailed descriptions of each
argument, and an optional list of dependencies that the reporter has on other
packages.  For example, here is the &lt;help&gt; section for the gcc version
reporter.
<screen>
  &lt;help&gt;
    &lt;ID&gt;help&lt;/ID&gt;
    &lt;name&gt;cluster.compiler.gcc.version&lt;/name&gt;
    &lt;version&gt;2&lt;/version&gt;
    &lt;description&gt;Reports the version of gcc&lt;/description&gt;
    &lt;url&gt;http://gcc.gnu.org&lt;/url&gt;
    &lt;argDescription&gt;
      &lt;ID&gt;help&lt;/ID&gt;
      &lt;accepted&gt;no|yes&lt;/accepted&gt;
      &lt;description&gt;display usage information (no|yes)&lt;/description&gt;
      &lt;default&gt;no&lt;/default&gt;
    &lt;/argDescription&gt;
    &lt;argDescription&gt;
      &lt;ID&gt;log&lt;/ID&gt;
      &lt;accepted&gt;[012345]|debug|error|info|system|warn&lt;/accepted&gt;
      &lt;description&gt;log message types included in report&lt;/description&gt;
      &lt;default&gt;0&lt;/default&gt;
    &lt;/argDescription&gt;
    &lt;argDescription&gt;
      &lt;ID&gt;verbose&lt;/ID&gt;
      &lt;accepted&gt;[012]&lt;/accepted&gt;
      &lt;description&gt;verbosity level (0|1|2)&lt;/description&gt;
      &lt;default&gt;1&lt;/default&gt;
    &lt;/argDescription&gt;
    &lt;argDescription&gt;
      &lt;ID&gt;version&lt;/ID&gt;
      &lt;accepted&gt;no|yes&lt;/accepted&gt;
      &lt;description&gt;show reporter version (no|yes)&lt;/description&gt;
      &lt;default&gt;no&lt;/default&gt;
    &lt;/argDescription&gt;
    &lt;dependency&gt;
      &lt;ID&gt;Inca::Reporter&lt;/ID&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;ID&gt;Inca::Reporter::Version&lt;/ID&gt;
    &lt;/dependency&gt;
  &lt;/help&gt;
</screen>
  </para> </listitem>
  </varlistentry>
</variablelist>

</section>
<section id="reporter-api">
<title>Reporter APIs</title>
<para>
The Inca release includes a set of <ulink url="http://inca.sdsc.edu/releases/&ugVersion/perldocs/">Perl modules</ulink> that make it easier to
develop reporters that produce output as shown in <xref linkend="reporter-output">
 and conform to the schema described in <xref linkend="reporter-schema">.  
The following are a list of modules and their purpose (click on module names for manpages):</para>
<orderedList>
<listItem>
  <para><ulink url="http://inca.sdsc.edu/releases/&ugVersion/perldocs/Inca/Reporter.html">Inca::Reporter</ulink></para>
  <para>This module is the general reporter API and is the base class for all types of reporters.
Inca::Reporter automates determination of hostname, gmt, reporter name, etc.,  handles command-line parsing, 
provides an interface for log messages, and handles XML generation.
</para>
</listItem>

<listItem>
  <para><ulink url="http://inca.sdsc.edu/releases/&ugVersion/perldocs/Inca/Reporter/GlobusUnit.html">Inca::Reporter::GlobusUnit</ulink></para>
  <para>The Inca::Reporter::GlobusUnit module is used for Globus unit tests.  This package 
provides methods for running Globus jobs.</para>
</listItem>
 
<listItem>
  <para><ulink url="http://inca.sdsc.edu/releases/&ugVersion/perldocs/Inca/Reporter/GridProxy.html">Inca::Reporter::GridProxy</ulink></para>
  <para>The Inca::Reporter::GridProxy package is a pseudo-module indicating that a reporter requires a proxy credential in order to execute.  The following is an example of a reporter that requires a proxy:
<screen>#!/usr/bin/env perl

use strict;
use warnings;
use Inca::Reporter::SimpleUnit;

my $reporter = new Inca::Reporter::SimpleUnit(
  name => 'grid.middleware.globus.unit.proxy',
  version => 2,
  description => 'Verifies that user has valid proxy',
  url => 'http://www.globus.org/security/proxy.html',
  unit_name => 'validproxy'
);
$reporter->addDependency( "Inca::Reporter::GridProxy" );
$reporter->processArgv(@ARGV);

# check to see if proxy has enough time left
$reporter->log( 'info', "X509_USER_PROXY=$ENV{X509_USER_PROXY}" );
my $output = $reporter->loggedCommand('grid-proxy-info -exists -hours 4 2>&1');
if( $? != 0 ) {
  $reporter->unitFailure("grid-proxy-info failed: $! $output");
} else {
  $reporter->unitSuccess();
}
$reporter->print();
</screen>
</para>
</listItem>
 
<listItem>
  <para><ulink url="http://inca.sdsc.edu/releases/&ugVersion/perldocs/Inca/Reporter/Performance.html">Inca::Reporter::Performance</ulink></para>
  <para>The Inca::Reporter::Performance module is used to gather system performance metrics.  This package 
defines a common &lt;body&gt; schema for system/software performance metric reporters and produces a collection of benchmarks, each a set of 
parameters (name/value) and statistics (name/value/units). For a single benchmark, the <ulink url="http://inca.sdsc.edu/releases/&ugVersion/perldocs/Inca/Reporter/Performance/Benchmark.html">Inca::Test::Reporter::Performance::Benchmark</ulink> module is also available.</para>
</listItem>
 
<listItem>
  <para><ulink url="http://inca.sdsc.edu/releases/&ugVersion/perldocs/Inca/Reporter/SimpleUnit.html">Inca::Reporter::SimpleUnit</ulink></para>
  <para>The Inca::Reporter::SimpleUnit module is used for software unit tests.  This package 
defines a common &lt;body&gt; schema for unit test reporters and provides methods for recording results of unit tests.</para>
</listItem>

<listItem>
  <para><ulink url="http://inca.sdsc.edu/releases/&ugVersion/perldocs/Inca/Reporter/Usage.html">Inca::Reporter::Usage</ulink></para>
  <para>The Inca::Reporter::Usage module is used for creating simple usage reports.</para>
</listItem>

<listItem>
  <para><ulink url="http://inca.sdsc.edu/releases/&ugVersion/perldocs/Inca/Reporter/Version.html">Inca::Reporter::Version</ulink></para>
  <para>The Inca::Reporter::Version module is used for reporting software versions.  This package 
defines a common &lt;body&gt; schema for version reporters,  
offers support for subpackage versions, and provides convenience methods for common ways of 
determining version.</para>
</listItem>

</orderedList>

<para>The following is the Perl code for a reporter that produces output like <xref linkend="sample-report">.  This reporter 
uses the Inca::Reporter::Version module to determine the version of gcc.  Examples of reporters that use the other Perl modules are 
located in $INCA_DIST/Inca-Reporter-*/bin.
<screen>#!/usr/bin/env perl

use strict;
use warnings;
use Inca::Reporter::Version;

my $reporter = new Inca::Reporter::Version(
  name => 'cluster.compiler.gcc.version',
  version => 2,
  description => 'Reports the version of gcc',
  url => 'http://gcc.gnu.org',
  package_name => 'gcc'
);
$reporter->processArgv(@ARGV);

$reporter->setVersionByExecutable('gcc -dumpversion');
$reporter->print();
</screen>
</para>

</section> 
<section id="writing-tips"> 
<title>Reporter Writing Tips</title>
<para>In general using the reporter APIs described in 
<xref linkend="reporter-api"> will help to produce the most 
efficient reporter code.  There are additional considerations when
writing reporters that:
<itemizedList>
<listItem><para>create temporary files and directories</para></listItem>
<listItem><para>cd to directories with variable names</para></listItem>
<listItem><para>include variable information like timestamps or PIDs in the
exit error message</para></listItem>
</itemizedList>
</para>
<para>For reporters that create temporary files or directories, the perl APIs offer 
a function called "tempFile" to remove them.  If the tempFile function is used then 
additional code to remove temporary files or directories (e.g. unlink or rm)
is not required.  The reporter below uses the tempFile function to remove 
the temp $scratchDir it creates.  
</para>
<para>
If a reporter changes directories to one whose name is variable, like the one below that includes a PID, it's good practice 
to have the reporter change back to the original directory before exiting.  If 
the reporter does not return to the original directory and the directory it changes to contains 
a PID, for example, a report will be created in the database each time the reporter runs (one 
for each reporter working dirctory).  For similar reasons, it's best practice never to use a 
PID or variable information as a reporter argument value or to include PIDs or timestamps in 
error messages.  If a reporter error message may contain variable information, a function to replace 
the variable can be written to normalize the error (like the "failClean" function in the reporter below).
</para>
<para> <screen>#!/usr/bin/env perl

use strict;
use warnings;
use Inca::Reporter::SimpleUnit;
use Date::Parse;
use Cwd;

my $reporter = new Inca::Reporter::SimpleUnit(
  name => 'security.ca.unit',
  version => 9,
  description => 'Checks whether the CA certificates or CRLs have expired',
  unit_name => 'caCertNCrlExpire'
);

 ...

my $origDir = getcwd();
my $scratchDir = "/tmp/security.ca.unit.$$";
if ( ! mkdir($scratchDir) ) {
  failClean("Cannot mkdir scratch dir $scratchDir"); 
}
$reporter->tempFile( $scratchDir );
if ( ! chdir($scratchDir) ) {
  failClean("Cannot change to scratch dir $scratchDir"); 
}

 ...

if ($err ne ""){
  failClean($err);
} else {
  $reporter->unitSuccess();
  chdir($origDir);
  $reporter->print();
}

sub failClean {
  my $err = shift;
  $err =~ s/--\d{2}:\d{2}:\d{2}--/--xx:xx:xx--/g;
  $err =~ s/$$/PID/g;
  chdir($origDir);
  $reporter->failPrintAndExit($err);
}</screen></para>
  </section>
</section>

<section id="reporter-repositories">
<title>Reporter Repositories</title>
<para>
The Inca system retrieves reporters from external collections called
repositories.  A reporter repository is simply a file directory, accessed via a
file: or http: URL, that contains a catalog file named Packages.gz.  This
gzipped file includes a sequence of name:value attribute pairs for every
reporter and support package in the repository; blank lines separate the
attributes for different reporters.  For example, here is a portion of the
Packages.gz file for the Inca standard reporter repository.
</para>
<screen>
arguments: help no|yes no;log [012345]|debug|error|info|system|warn 0;verbose [0
12] 1;version no|yes no
dependencies: Inca::Reporter;Inca::Reporter::Version
description: Reports the version of tgusage
file: cluster.accounting.tgusage.version
name: cluster.accounting.tgusage.version
url: http://www.teragrid.org
version: 2

arguments: help no|yes no;log [012345]|debug|error|info|system|warn 0;verbose [0
12] 1;version no|yes no
dependencies: Inca::Reporter;Inca::Reporter::SimpleUnit
description: ant hello world test
file: cluster.admin.ant.unit
name: cluster.admin.ant.unit
version: 3

arguments: help no|yes no;log [012345]|debug|error|info|system|warn 0;verbose [0
12] 1;version no|yes no
dependencies: Inca::Reporter;Inca::Reporter::Version
description: Reports the version of Apache Ant
file: cluster.admin.ant.version
name: cluster.admin.ant.version
version: 2

</screen>
<para>
Of the attributes shown, only file and name are required.  The file attribute
gives the relative path to the reporter file, and the name attribute specifies
the unique package name of the reporter.  If the reporter requires support
packages to execute, it should include a dependencies attribute with a
semicolon-separated list of package names.  For more information about reporter 
package dependencies see <xref linkend="package-depend">.  The incat administration tool uses
the Packages.gz file's arguments and description attributes as part of its series edit dialog.
The value of the arguments attribute is a semicolon-separated list giving the
name, value pattern, and default value, if any, for each supported command-line
argument.
</para><para>
To create a local repository for your own reporters, you only need to collect
them into a directory and create a Packages.gz in that directory. The default Inca installation has a 
Packages.gz file in $INCA_DIST/Inca-Reporter-* that can be added in incat.  Inca also supplies 
<ulink url="http://inca.sdsc.edu/repository/latest/cgi-bin/list_reporters.cgi">a web accessible
repository</ulink> that can be added in incat as "http://inca.sdsc.edu/repository/latest/". 
</para>
<para>The Inca
distribution includes a perl script, incpack, that can create Packages.gz for
you.  Simply run incpack with a list of reporters that you want to include in
Packages.gz, e.g.,
</para>
<screen>% perl incpack jade.version f77.unit vim.version</screen>
<para>
incpack runs each of the listed reporters with --help=yes --verbose=1 to
extract a standard set of attributes.  If your reporters use the Inca reporter
perl modules, you might need to run incpack with a -I switch to specify the
location of the Inca perl library, like this.
</para>
<screen>% perl incpack -I ${INCA_DIST}/lib jade.version f77.unit vim.version</screen>

<section id="package-depend">
<title>Reporter Package Dependencies</title>
<para>Some reporters use packaged tests for their results.  For example, the Basic Linear 
Algebra Subprograms (BLAS) have a set of packaged fortran tests that come with the 
BLAS software.  Reporters can use packaged tests if the tests are 1) bundled into a .tar.gz file, 
2) noted as a dependency in the reporters, and 3) added using incpack to the reporter repository.</para>

<orderedList>
<listItem><para>In the case of the BLAS tests, a file called <filename>blasTestSuite.tar.gz</filename> was created
in the <filename>share</filename> directory under the reporter repository.  The <filename>blasTestSuite.tar.gz</filename> file 
contains:
<screen>Makefile.in     cblat2d         configure       dblat2.f        dblat3d         sblat2d         zblat1.f        zblat3.f
cblat1.f        cblat3.f        configure.in    dblat2d         sblat1.f        sblat3.f        zblat2.f        zblat3d
cblat2.f        cblat3d         dblat1.f        dblat3.f        sblat2.f        sblat3d         zblat2d</screen>
</para>
</listItem>
<listItem>
<para>Reporters that use the BLAS tests include the following line with the first part of the .tar.gz filename:
<screen>$reporter->addDependency('blasTestSuite');</screen>
</para>
</listItem>
<listItem>
<para>After reporters include the dependency line, the reporter repository needs to be updated with both the reporter 
itself and its package dependencies (e.g. <filename>blasTestSuite.tar.gz</filename>).  In order to update the 
reporter repository with a package dependency an .attrib file is required and must contain 
the package dependency's file name, version number, description, and any urls or dependencies.
For BLAS, a file called <filename>blasTestSuite.tar.gz.attrib</filename> was created in the 
<filename>share</filename> directory containing:
<screen>name: blasTestSuite
version: 1.0
description: Test programs for the BLAS library
url: http://inca.sdsc.edu
dependencies:</screen>
</para>
<para>
Then the dependency is added to the repository using incpack (see <xref linkend="update-repository">
for more about repository updates):
<screen>% sbin/incpack share/blasTestSuite.tar.gz
Note: Appending to existing Packages.gz file
share/blasTestSuite.tar.gz
Note: replacing entry in catalog for file share/blasTestSuite.tar.gz</screen>
</para>
</listItem>
</orderedList>
<para>The agent installs package dependencies on the reporter managers under 
<filename>$RM_INSTALL_DIR/var/reporter-packages/build</filename> (reporters are 
installed under <filename>$RM_INSTALL_DIR/var/reporter-packages/bin</filename>).
Then the .tar.gz package dependency files are unzipped and untarred and configured 
according to what files are contained in the tar ball.  If the tar ball contains a 
<filename>configure</filename> file, like <filename>blasTestSuite.tar.gz.attrib</filename>,
then then the following commands are executed inside the reporter dependency directory once 
it's untarred:
<screen>% ./configure; gmake || make; gmake install || make install</screen>
</para><para>
If a <filename>configure</filename> file isn't found, but a <filename>[M|m]akefile</filename> file
is found, then the following is executed:
<screen>% gmake || make; gmake install || make install</screen>
</para><para>
If <filename>configure</filename> and <filename>[M|m]akefile</filename> files aren't found, but a <filename>Makefile.PL</filename> file
is found, then the following is executed:
<screen>% perl Makefile.PL 
  PREFIX=lib/perl \
  LIB=lib/perl \
  INSTALLDIRS=perl \
  INSTALLSCRIPT=bin \
  INSTALLMAN1DIR=man/man1 \
  INSTALLMAN3DIR=man/man3;
gmake || make; gmake install || make install</screen>
</para><para>
If <filename>configure</filename>, <filename>[M|m]akefile</filename>, and <filename>Makefile.PL</filename> 
files aren't found, but a <filename>Build.PL</filename> file
is found, then the following is executed:
<screen>% perl -I lib/perl Build.PL \
  --install_path lib=lib/perl \
  --install_path libdoc=man/man3 \
  --install_path bindoc=man/man1 \
  --install_path bin=bin \
  --install_path script=bin \
  --install_path arch=lib/perl;
perl -I lib/perl Build; perl -I lib/perl Build install</screen>
</para><para>
If <filename>configure</filename>, <filename>[M|m]akefile</filename>, <filename>Makefile.PL</filename> 
and <filename>Build.PL</filename> files aren't found, then the package dependency .tar.gz file is just 
unzipped and untarred.</para>
</section>


<section id="update-repository">
<title>Updating Reporter Repositories</title>
<para>The Inca agent will detect changes to your reporter repository and
automatically send changes to the appropriate reporter managers if you:
</para>
<orderedList>
<listItem><para>
update the reporter version number (ie. change a line like "version =>
1" to "version => 2" in the body of the reporter)
</para></listItem>

<listItem><para>
make sure the reporter permissions are set so the agent can fetch the
reporter (755 is the standard reporter permission)
</para></listItem>

<listItem><para>update your Packages.gz file using incpack.  The command will
be something like:
<screen>% cd $INCA_DIST/Inca-Reporter-*; ./sbin/incpack -I lib bin/&lt;reportername&gt;</screen>
</para></listItem>

<listItem><para>
wait for the agent to deploy the new reporter automatically (it looks
for new reporters every four hours by default),
</para> <para>
*OR*
</para> <para>
restart the agent,
</para> <para>
*OR*
</para> <para>
Connect to the agent in incat, select the Repositories tab, then press the
Refresh button under the repository panel.
</para></listItem>
</orderedList>
<para>
If the revised reporter still isn't deployed, look for any errors in the
$INCA_DIST/var/agent.log that indicate the
agent was unable to fetch the reporter or skipped over updating it.  Make
sure there is an active series that uses the reporter with "use latest
version" checked on the resource your intend it to run on incat.  Look for
$INCA_DIST/var/repository/repository.xml entries for the
reporter with "&lt;latestVersion&gt;false&lt;/latestVersion&gt;" (should be
"&lt;latestVersion&gt;true&lt;/latestVersion&gt;" to get the updated reporters).
</para>
</section>

</section>
</section>
