<section id="communication-protocol">
<title>Inca Protocol</title>

<para>
The Inca protocol is intended sit on top of TCP and SSL and enable the basic
communication between Inca components. 
</para>

<section id="communication-protocol-types">
<title>Message Types</title>

<para>The protocol is made of a single message pattern referred to as a
<emphasis>Statement</emphasis>:
</para>

<para>
CMD SP DATA CRLF
</para>

<para>where</para>

<variableList>
  <varListEntry>
    <term><emphasis>CMD</emphasis></term>
    <listItem>
      <para>A text string indicating an action or description of the data
      that follows.
      </para>
    </listItem>
  </varListEntry>
  <varListEntry>
    <term><emphasis>SP</emphasis></term>
    <listItem>
      <para>A space.
      </para>
    </listItem>
  </varListEntry>
  <varListEntry>
    <term><emphasis>DATA</emphasis></term>
    <listItem>
      <para>The crux of the message containing any stream of characters except
      CRLF.
      </para>
    </listItem>
  </varListEntry>
  <varListEntry>
    <term><emphasis>CRLF</emphasis></term>
    <listItem>
      <para>A carriage return followed by a line feed indicating the end of
      the statement.
      </para>
    </listItem>
  </varListEntry>
</variableList>


</section>
<section id="communication-protocol-basic">
<title>Basic Commands</title>
<para>
There is a small set of basic commands which all Inca components that act as
servers implement.
</para>
<variableList>
<varListEntry>
	<term><emphasis>START SP Version CRLF</emphasis></term>
	<listItem>
	<para>
	This command indicates the beginning of a new conversation.  A version check
is done by the server to be sure that the components are compatible.
	</para>
	</listItem>
</varListEntry>
<varListEntry>
	<term><emphasis> END SP Code CRLF</emphasis></term>
	<listItem>
	<para>
	This command indicates that a component would like to end the conversation.
This can be sent by a server or a client, but the component that sends this
message must keep their Socket alive until they detect that the other
component has closed their socket.
	</para>
	</listItem>
</varListEntry>
<varListEntry>
	<term><emphasis> ERROR SP Error Message CRLF</emphasis></term>
	<listItem>
	<para>
	The behavior here is similar to that of End.  The difference is that the
receiver should see that there was an error and act accordingly.
	</para>
	</listItem>
</varListEntry>
<varListEntry>
	<term><emphasis> PING SP Test Data  CRLF</emphasis></term>
	<listItem>
	<para>
	The component should respond with PINGACK SP Test Data CRLF.
	</para>
	</listItem>
</varListEntry>
</variableList>

<para>Each Inca component will implement additional commands.  Each statement
must follow the same format.  A command can require several statements.
After the first statement is identified the socket is handed off to the
correct handler which can then send and receive messages as needed.
</para>
</section>

<section id="communication-protocol-example">
<title>Example Conversations</title>
<para>The following examples demonstrate that the components can add their own
commands to the protocol as well as use the basic built-in commands.</para>
<variableList>
	<varListEntry>
	<term>Reporter Manager(RM) to Depot(D)</term>
	<listItem>
	<para>In the following conversation the depot will not need to send any
response.  Note, that order must be maintained.</para>
	<para>RM: START SP 1 CRLF</para>
	<para>RM: REPORT SP {reporter name} CRLF </para>
	<para>RM: STDERR SP {data} CRLF</para>
	<para>RM: STDOUT SP {data} CRLF</para>
	<para>RM: SYSUSAGE SP {data} CRLF</para>
	<para>RM: END SP 100 CRLF</para>
	</listItem>
	</varListEntry>
	<varListEntry>
	<term>Reporter Manager(RM) to Depot(D)</term>
	<listItem>
	<para>The depot detects a protocol error and responds.  </para>
	<para>RM: START SP 1 CRLF</para>
	<para>RM: REPORT SP {reporter name} CRLF </para>
	<para>RM: STDERR SP {data} </para>
	<para>RM: SYSUSAGE SP {data} CRLF</para>
	<para>D: ERROR SP {error message} CRLF</para>
	</listItem>
	</varListEntry>
	<varListEntry>
	<term>Reporter Agent(RA) to Depot(D)</term>
	<listItem>
	<para>RA:  CONFIG SP INCA/1.0 CRLF {config XML document} CRLF</para>
	<para>D:  OK 100 CRLF</para>
	</listItem>
	</varListEntry>
	<varListEntry>
	<term>Reporter Manager(RM) to Reporter Agent(RA)</term>
	<listItem>
	<para>RM:  POLL SP INCA/1.0 CRLF CRLF</para>
	<para>RA:  ADD SP INCA/1.0 CRLF {config XML document} CRLF</para>
	<para>RA:  DELETE SP INCA/1.0 CRLF {config XML document} CRLF CRLF</para>
	<para>RM:  OK 100 CRLF</para>
	</listItem>
	</varListEntry>
</variableList>
</section>

</section>
