Readme for updateIncat
=======================

This tool is used to make automatic updates to the XSEDE Inca deployment based
on data from kit registrations.

Files:
======

config.xml = original config file that holds manually added resources and 
             custom macros as well as suites.  Does not contain kit queries
             which are auto=generated from kit definition files in etc/kits

config=auto.xml = current version of config file to use to generate a 
                  fresh incat=auto.xml file.

incat=auto.xml = auto=generated incat file to send to agent

Tools:
======

./bin/generateConfig = generates config=auto.xml from config.xml and kit
                       definition files in etc/kits.  Should only need to be
                       run if changes are made to config.xml or etc/kits.

./bin/updateIncat = generates a fresh incat file based on input from a 
                    fresh cache file.  If used with the 'auto' argument, it
                    will reference the files indicated above.

./bin/verifyIncat = wrapper for SuiteStagesWrapper main program.  If used with
                    the 'auto' argument, will expand incat=auto.xml and place
                    the new suite files in "newsuites" and the compare them
                    against "cursuites"

General Procedures:
===================

Case 1:  changes in the cache are detected
------------------------------------------

1. Copy cache.new file from gw60 and rename it cache

2. If you do not have an up-to-date cursuites dir already, run

% ./bin/verifyIncat expand -i <current incat file> -s cursuites

3. Run updateIncat to generate new incat file incat-auto-new.xml

% ./bin/updateIncat auto

4. Verify changes 

% ./bin/verifyIncat auto

5. Verify changes in diff.log look reasonable

6. Commit changes by commiting the diffs between incat-auto-new.xml and
incat-auto.xml 

% ./bin/commitIncat auto

This will create an incat-diff.xml file and be displayed to stdout.  Check
the incat-diff file and if it looks good, re-run with the -f option.

% ./bin/commitIncat -f auto

Press enter to continue after incat-diff is displayed.  The incat-auto-new.xml
will then be moved to incat-auto.xml.

