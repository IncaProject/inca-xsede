Readme for updateIncat
=======================

This tool is used to make automatic updates to the XSEDE Inca deployment based
on data from kit registrations.

Files:
======

config.xml = original config file that holds manually added resources and 
             custom macros as well as suites.  Does not contain kit queries
             which are auto-generated from kit definition files in etc/kits

config-auto.xml = current version of config file to use to generate a 
                  fresh incat-auto.xml file.

incat-auto.xml = auto=generated incat file to send to agent

Tools:
======

./bin/downloadKitRegs = downloads a current copy of the kit registrations
                        to kit-regs.xml
                        
./bin/generateConfig = generates config-auto.xml from config.xml and kit
                       definition files in etc/kits.  Should only need to be
                       run if changes are made to config.xml or etc/kits.

./bin/updateIncat = generates a fresh incat file based on input from a 
                    fresh cache file.  If used with the 'auto' argument, it
                    will reference the files indicated above.

./bin/verifyIncat = wrapper for SuiteStagesWrapper main program.  If used with
                    the 'auto' argument, will expand incat-auto.xml and place
                    the new suite files in "newsuites" and the compare them
                    against "cursuites"

General Procedures:
===================

Case 1:  changes in the cache are detected
------------------------------------------

1. Download a fresh copy of the kit registrations from info.teragrid.org

% ./bin/downloadKitRegs

2. Run updateIncat to generate new incat file incat-auto-new.xml

% ./bin/updateIncat auto

3. Verify changes 

% ./bin/verifyIncat auto

4. Verify changes in diff.log look reasonable

5. Commit changes by commiting the diffs between incat-auto-new.xml and
incat-auto.xml 

% ./bin/commitIncat auto

This will create an incat-diff.xml file and be displayed to stdout.  Check
the incat-diff file and if it looks good, re-run with the -f option.

% ./bin/commitIncat -f auto

Press enter to continue after incat-diff is displayed.  The incat-auto-new.xml
will then be moved to incat-auto.xml and newsuites will replace the
cursuites dir.

Case 2:  changes in etc/def2config.xsl and/or config.xml are needed
-----------------------------------------------------------------

1. Make needed changes in etc/def2config.xsl and/or config.xml

2. Re-generate config-auto.xml

% ./bin/generateConfig

3. Follow steps 2 - 5 above
